<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloading Queries • esaj</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">esaj</a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/download_lawsuit.html">Downloading Lawsuits</a>
    </li>
    <li>
      <a href="../articles/download_query.html">Downloading Queries</a>
    </li>
    <li>
      <a href="../articles/download_decision.html">Downloading Decisions</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/courtsbr/esaj">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Downloading Queries</h1>
            
          </div>

    
    
<div class="contents">
<p>Besides downloading lawsuits (see the <strong>Downloading Lawsuits</strong> article), <code>esaj</code> also allows the user to download the results of a query on lawsuits. This kind of query is very useful for finding out what lawsuits contain certain words, were filed in a given period, were filed in a given court, etc.</p>
<p>To accomplish this task two functions were made available: <code><a href="../reference/download_cjpg.html">download_cjpg()</a></code> (for queries on first degree lawsuits) and <code><a href="../reference/download_cjsg.html">download_cjsg()</a></code> (for queries on second degree lawsuits). There are also two auxiliary functions that can help the user to evaluate how long this kind of download might take: <code><a href="../reference/peek_cjpg.html">peek_cjpg()</a></code> and <code><a href="../reference/peek_cjsg.html">peek_cjsg()</a></code>. Finally, there are 3 functions to explore which arguments to use when calling the functions above: <code><a href="../reference/cjpg_table.html">cjpg_table()</a></code>, <code><a href="../reference/cjsg_table.html">cjsg_table()</a></code>, and <code><a href="../reference/browse_table.html">browse_table()</a></code>.</p>
<p>As of the day of this writing, all aforementioned functions only work with São Paulo’s Justice Court (TJSP).</p>
<div id="basic-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic usage</h2>
<p>To run a query on first degree lawsuits and download the results, simply write the query as a string and supply the path to the directory where to download all resulting files. The example below finds all lawsuits containing the word “recurso”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(<span class="st">"recurso"</span>, <span class="st">"~/Desktop/"</span>)
<span class="co">#&gt; [1] "/Users/ctlente/Desktop/search.html"</span>
<span class="co">#&gt; [2] "/Users/ctlente/Desktop/page1.html"</span></code></pre></div>
<p>As you can see, <code>download_cj*g()</code> return the paths to the downloaded files. The first file always refers to the search page, containing the filled fields and the first results of the query; the subsequent files contain pages of results (as many pages as requested by the user).</p>
<p>By default <code>download_cj*g()</code> download only one page of results, but we can also specify page indexes to start and stop downloading.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(<span class="st">"recurso"</span>, <span class="st">"~/Desktop/"</span>, <span class="dt">min_page =</span> <span class="dv">3</span>, <span class="dt">max_page =</span> <span class="dv">6</span>)
<span class="co">#&gt; [1] "/Users/ctlente/Desktop/search.html"</span>
<span class="co">#&gt; [2] "/Users/ctlente/Desktop/page3.html" </span>
<span class="co">#&gt; [3] "/Users/ctlente/Desktop/page4.html" </span>
<span class="co">#&gt; [4] "/Users/ctlente/Desktop/page5.html" </span>
<span class="co">#&gt; [5] "/Users/ctlente/Desktop/page6.html"</span></code></pre></div>
<p>To help you filter the results even more, many other arguments are also made available. <code><a href="../reference/download_cjpg.html">download_cjpg()</a></code> and <code><a href="../reference/download_cjsg.html">download_cjsg()</a></code> have slightly different ones, so make sure to run <code><a href="../reference/download_cjpg.html">?download_cjpg</a></code> or <code><a href="../reference/download_cjsg.html">?download_cjsg</a></code> to learn more about them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Repeted arguments</span>
query &lt;-<span class="st"> "recurso"</span>
path &lt;-<span class="st"> "~/Desktop/"</span>

<span class="co"># First degree query</span>
<span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(query, path, <span class="dt">classes =</span> <span class="kw">c</span>(<span class="st">"8727"</span>, <span class="st">"8742"</span>))
<span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(query, path, <span class="dt">subjects =</span> <span class="st">"3372"</span>)
<span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(query, path, <span class="dt">courts =</span> <span class="st">"2-1"</span>)
<span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(query, path, <span class="dt">date_start =</span> <span class="st">"2016-01-01"</span>, <span class="dt">date_end =</span> <span class="st">"2016-12-31"</span>)

<span class="co"># Second degree query</span>
<span class="kw"><a href="../reference/download_cjsg.html">download_cjsg</a></span>(query, path, <span class="dt">classes =</span> <span class="kw">c</span>(<span class="st">"1231"</span>, <span class="st">"1232"</span>))
<span class="kw"><a href="../reference/download_cjsg.html">download_cjsg</a></span>(query, path, <span class="dt">subjects =</span> <span class="st">"0"</span>)
<span class="kw"><a href="../reference/download_cjsg.html">download_cjsg</a></span>(query, path, <span class="dt">courts =</span> <span class="st">"0-56"</span>)
<span class="kw"><a href="../reference/download_cjsg.html">download_cjsg</a></span>(query, path, <span class="dt">trial_start =</span> <span class="st">"2009-01-01"</span>, <span class="dt">trial_end =</span> <span class="st">"2009-12-31"</span>)
<span class="kw"><a href="../reference/download_cjsg.html">download_cjsg</a></span>(query, path, <span class="dt">registration_start =</span> <span class="st">"1998-01-01"</span>,
              <span class="dt">registration_end =</span> <span class="st">"1998-12-31"</span>)</code></pre></div>
<p>The output of the calls above are omitted because they are exactly the same. Despite only <code>classes</code> appearing as a character vector, <code>subjects</code> and <code>courts</code> also support this kind of input.</p>
<p>An argument not mentioned above is <code>cores</code>. This is a very useful tool for parallelizing the execution of <code>download_cj*g()</code> and the value passed on to it corresponds to the number of processing cores used when downloading the files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/download_cjpg.html">download_cjpg</a></span>(<span class="st">"recurso"</span>, <span class="st">"~/Desktop/"</span>, <span class="dt">max_page =</span> <span class="dv">10</span>, <span class="dt">cores =</span> <span class="dv">4</span>)</code></pre></div>
</div>
<div id="peeking" class="section level2">
<h2 class="hasAnchor">
<a href="#peeking" class="anchor"></a>Peeking</h2>
<p>As you might have guessed, the functions above can take a non-trivial amount of time to finish executing (specially when there are many pages to download). To help the user estimate how much time calls to <code>download_cj*g()</code> would take, <code>peek_cj*g()</code> were made available.</p>
<p>These functions take the same arguments as <code>download_cj*g()</code> (ignoring <code>path</code> and <code>cores</code>) and calculate approximatelly how much time it would take to download all pages of results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/peek_cjsg.html">peek_cjsg</a></span>(query, path, <span class="dt">classes =</span> <span class="kw">c</span>(<span class="st">"1231"</span>, <span class="st">"1232"</span>))
<span class="co">#&gt; There are 49 pages to download</span>
<span class="co">#&gt; This should take around 25 seconds</span></code></pre></div>
<p><code>path</code> is ignored because the files won’t actually be downloaded. <code>cores</code> is ignored because it’s very hard to guess how much time is saved by parallelizing the process, so the estimate only takes one thread into account.</p>
</div>
<div id="tables" class="section level2">
<h2 class="hasAnchor">
<a href="#tables" class="anchor"></a>Tables</h2>
<p>Since <code>download_cj*g()</code> have very complex arguments, there are 3 other functions that help the user know which values should be passed on to <code>classes</code>, <code>subjects</code>, and <code>courts</code>.</p>
<p><code>cj*g_table()</code> take only one argument, <code>type</code>, which should be one of <code>"classes"</code>, <code>"subjects"</code>, and <code>"courts"</code>. They will return tibbles with all possible values for the corresponding arguments in <code>download_cj*g()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(<span class="kw"><a href="../reference/cjpg_table.html">cjpg_table</a></span>(<span class="st">"classes"</span>))
<span class="co">#&gt; Observations: 757</span>
<span class="co">#&gt; Variables: 12</span>
<span class="co">#&gt; $ name0 &lt;chr&gt; "CLASSES ANTIGAS DO SAJ", "PROCESSO CÍVEL E DO TRABALHO"...</span>
<span class="co">#&gt; $ id0   &lt;chr&gt; "768", "8500", "8500", "8500", "8500", "8500", "8500", "...</span>
<span class="co">#&gt; $ name1 &lt;chr&gt; NA, "Processo de Conhecimento", "Processo de Conheciment...</span>
<span class="co">#&gt; $ id1   &lt;chr&gt; NA, "8716", "8716", "8716", "8716", "8716", "8716", "871...</span>
<span class="co">#&gt; $ name2 &lt;chr&gt; NA, "Procedimento de Cumprimento de Sentença/Decisão", "...</span>
<span class="co">#&gt; $ id2   &lt;chr&gt; NA, "8591", "8591", "8591", "8591", "8591", "8586", "858...</span>
<span class="co">#&gt; $ name3 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Pro...</span>
<span class="co">#&gt; $ id3   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "850...</span>
<span class="co">#&gt; $ name4 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Pro...</span>
<span class="co">#&gt; $ id4   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "850...</span>
<span class="co">#&gt; $ name5 &lt;chr&gt; "CLASSES ANTIGAS DO SAJ", "Cumprimento Provisório de Dec...</span>
<span class="co">#&gt; $ id5   &lt;chr&gt; "768", "8816", "8817", "8592", "8593", "4052", "4062", "...</span></code></pre></div>
<p>Note how the table above has multiple levels, marked 0 through 5. This is because the class structure is a tree, so higher levels represent classes closer to the leaves. In the example above, the valid values for the <code>classes</code> argument in <code><a href="../reference/download_cjpg.html">download_cjpg()</a></code> are every single number in the <code>id*</code> columns.</p>
<p><code>cj*g_table("subjects")</code> have very similar structures to <code>cj*g_table("classes")</code>. <code>cj*g_table("courts")</code> have only one level.</p>
<p>To browse <code>classes</code> and <code>subjects</code> tables, one can also use the <code><a href="../reference/browse_table.html">browse_table()</a></code> function. This method uses a list of regex to filter the tibbles returned by <code>cj*g_table("classes")</code> and <code>cj*g_table("subjects")</code> more easily than <code><a href="http://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cjpg_table.html">cjpg_table</a></span>(<span class="st">"classes"</span>)
<span class="kw"><a href="../reference/browse_table.html">browse_table</a></span>(table, <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">"ADM"</span>, <span class="st">"CRIMINAL"</span>), <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"Recurso"</span>))
<span class="co">#&gt; # A tibble: 6 x 12</span>
<span class="co">#&gt;                           name0   id0    name1   id1 name2   id2 name3</span>
<span class="co">#&gt;                           &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1             PROCESSO CRIMINAL  8644 Recursos  8711  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; 2             PROCESSO CRIMINAL  8644 Recursos  8711  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; 3             PROCESSO CRIMINAL  8644 Recursos  8711  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; 4             PROCESSO CRIMINAL  8644 Recursos  8711  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; 5 PROCEDIMENTOS ADMINISTRATIVOS  8726     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; 6 PROCEDIMENTOS ADMINISTRATIVOS  8726     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</span>
<span class="co">#&gt; # ... with 5 more variables: id3 &lt;chr&gt;, name4 &lt;chr&gt;, id4 &lt;chr&gt;,</span>
<span class="co">#&gt; #   name5 &lt;chr&gt;, id5 &lt;chr&gt;</span></code></pre></div>
<p>For the matching to work properly, <code>patterns</code> should be a list of at most 6 character vectors, each one containing either one or a vector of regular expressions to be applied from left to right on columns <code>name0</code> to <code>name5</code>.</p>
<p>Note that vectors are ORed and different elements are ANDed. In the example above, we got back the rows where <code>name0</code> contains “ADM” <strong>or</strong> “CRIMINAL” <strong>and</strong> where <code>name5</code> contains “Recurso”.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#basic-usage">Basic usage</a></li>
      <li><a href="#peeking">Peeking</a></li>
      <li><a href="#tables">Tables</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="author">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a></p>
</div>
      </footer>
</div>

  </body>
</html>
